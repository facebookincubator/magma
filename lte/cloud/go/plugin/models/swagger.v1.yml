---
swagger: '2.0'

magma-gen-meta:
  go-package: magma/lte/cloud/go/plugin/models
  dependencies:
    - 'orc8r/cloud/go/models/swagger-common.yml'
    - 'orc8r/cloud/go/pluginimpl/models/swagger.v1.yml'
  temp-gen-filename: lte-swagger.yml
  output-dir: lte/cloud/go/plugin
  types:
    - go-struct-name: LteNetwork
      filename: lte_network_swaggergen.go
    - go-struct-name: NetworkCellularConfigs
      filename: network_cellular_configs_swaggergen.go
    - go-struct-name: NetworkRanConfigs
      filename: network_ran_configs_swaggergen.go
    - go-struct-name: NetworkEpcConfigs
      filename: network_epc_configs_swaggergen.go

info:
  title: LTE Network Management
  description: LTE REST APIs
  version: 1.0.0

basePath: /magma/v1

tags:
  - name: Enodeb
    description: eNodeB devices attached to the network
  - name: LTE Networks
    description: Endpoints related to LTE networks

paths:
  /ltenetworks:
    get:
      summary: List all LTE network IDs
      tags:
        - LTE Networks
      responses:
        '200':
          description: List of LTE network IDs
          schema:
            type: array
            items:
              type: string
            example:
              - lte_network1
              - lte_network2
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    post:
      summary: Create a new LTE network
      tags:
        - LTE Networks
      parameters:
        - name: lte_network
          in: body
          description: Configuration of the network to create
          required: true
          schema:
            $ref: '#/definitions/lte_network'
      responses:
        '201':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}:
    get:
      summary: Describe an LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: Full description of an LTE network
          schema:
            $ref: '#/definitions/lte_network'
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update an entire LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: lte_network
          in: body
          description: Full desired configuration of the network
          required: true
          schema:
            $ref: '#/definitions/lte_network'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    delete:
      summary: Delete an LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/name:
    get:
      summary: Get name of an LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: Name of the network
          schema:
            type: string
            example: Network Name
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update the name of an LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: name
          in: body
          description: New name for the network
          required: true
          schema:
            type: string
            example: Network Name
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/cellular:
    get:
      summary: Get cellular configuration of LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: Cellular configuration of the network
          schema:
            $ref: '#/definitions/network_cellular_configs'
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update cellular configuration of LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: config
          in: body
          description: New cellular configuration for the network
          required: true
          schema:
            $ref: '#/definitions/network_cellular_configs'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/cellular/epc:
    get:
      summary: Get EPC configuration of LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: EPC configuration of the network
          schema:
            $ref: '#/definitions/network_epc_configs'
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update EPC configuration of LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: config
          in: body
          description: New EPC configuration for the network
          required: true
          schema:
            $ref: '#/definitions/network_epc_configs'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/cellular/ran:
    get:
      summary: Get RAN configuration of LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: RAN configuration of the network
          schema:
            $ref: '#/definitions/network_ran_configs'
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update RAN configuration of LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: config
          in: body
          description: New RAN configuration for the network
          required: true
          schema:
            $ref: '#/definitions/network_ran_configs'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/cellular/feg_network_id:
    get:
      summary: Get Federation Gateway network ID for the network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: ID of the Federation Gateway network
          schema:
            type: string
            example: feg_network
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update the Federation Gateway network ID
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: feg_network_id
          in: body
          description: Desired federation gateway network ID
          required: true
          schema:
            type: string
            example: feg_network
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/dns:
    get:
      summary: Get DNS configuration of LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: DNS configuration of the network
          schema:
            $ref: './orc8r-swagger.yml#/definitions/network_dns_config'
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update DNS configuration of LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: config
          in: body
          description: New DNS configuration for the network
          required: true
          schema:
            $ref: './orc8r-swagger.yml#/definitions/network_dns_config'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/dns/records:
    get:
      summary: Get the DNS config records for the LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: Custom DNS records for the network
          schema:
            type: array
            items:
              $ref: './orc8r-swagger.yml#/definitions/dns_config_record'
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

    put:
      summary: Change all the DNS records for the LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: records
          in: body
          description: Custom DNS records for the network
          required: true
          schema:
            type: array
            items:
              $ref: './orc8r-swagger.yml#/definitions/dns_config_record'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/dns/records/{domain}:
    get:
      summary: Get the DNS config record for a specific domain
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - $ref: '#/parameters/dns_domain'
      responses:
        '200':
          description: DNS config record
          schema:
            $ref: './orc8r-swagger.yml#/definitions/dns_config_record'
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    post:
      summary: Create a DNS record for a specific domain
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - $ref: '#/parameters/dns_domain'
        - name: record
          in: body
          description: Custom DNS record for the domain
          required: true
          schema:
            $ref: './orc8r-swagger.yml#/definitions/dns_config_record'
      responses:
        '201':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update a DNS record for a specific domain
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - $ref: '#/parameters/dns_domain'
        - name: record
          in: body
          description: Custom DNS record for the domain
          required: true
          schema:
            $ref: './orc8r-swagger.yml#/definitions/dns_config_record'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    delete:
      summary: Delete the DNS record for a specific domain
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - $ref: '#/parameters/dns_domain'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

  /ltenetworks/{network_id}/features:
    get:
      summary: Get feature flags for LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
      responses:
        '200':
          description: Feature flags of the network
          schema:
            $ref: './orc8r-swagger.yml#/definitions/network_features'
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'
    put:
      summary: Update feature flags for LTE network
      tags:
        - LTE Networks
      parameters:
        - $ref: './orc8r-swagger-common.yml#/parameters/network_id'
        - name: config
          in: body
          description: New feature flags for the network
          required: true
          schema:
            $ref: './orc8r-swagger.yml#/definitions/network_features'
      responses:
        '204':
          description: Success
        default:
          $ref: './orc8r-swagger-common.yml#/responses/UnexpectedError'

parameters:
  dns_domain:
    in: path
    name: domain
    type: string
    description: DNS record domain
    required: true

definitions:
  lte_network:
    type: object
    description: LTE Network spec
    required:
      - id
      - name
      - description
      - cellular
      - dns
    properties:
      id:
        $ref: './orc8r-swagger-common.yml#/definitions/network_id'
      name:
        $ref: './orc8r-swagger-common.yml#/definitions/network_name'
      description:
        $ref: './orc8r-swagger-common.yml#/definitions/network_description'
      cellular:
        $ref: '#/definitions/network_cellular_configs'
      dns:
        $ref: './orc8r-swagger.yml#/definitions/network_dns_config'
      features:
        $ref: './orc8r-swagger.yml#/definitions/network_features'

  network_cellular_configs:
    description: Cellular configuration for a network
    type: object
    required:
      - ran
      - epc
    minLength: 1
    properties:
      ran:
        $ref: '#/definitions/network_ran_configs'
      epc:
        $ref: '#/definitions/network_epc_configs'
      feg_network_id:
        type: string
        example: 'example_feg_network'

  network_ran_configs:
    description: RAN (radio access network) cellular configuration for a network
    type: object
    minLength: 1
    required:
      - bandwidth_mhz
    properties:
      bandwidth_mhz:
        type: integer
        format: uint32
        example: 20
        enum:
          - 3
          - 5
          - 10
          - 15
          - 20
      fdd_config:
        type: object
        x-go-custom-tag: 'magma_alt_name:"NetworkRANConfigFDDConfig"'
        required:
          - earfcndl
          - earfcnul
        properties:
          earfcndl:
            type: integer
            format: uint32
            example: 0
          earfcnul:
            type: integer
            format: uint32
            example: 18000
      tdd_config:
        type: object
        x-go-custom-tag: 'magma_alt_name:"NetworkRANConfigTDDConfig"'
        required:
          - earfcndl
          - subframe_assignment
          - special_subframe_pattern
        properties:
          earfcndl:
            type: integer
            format: uint32
            example: 44590
          subframe_assignment:
            type: integer
            format: uint32
            example: 2
            maximum: 6
          special_subframe_pattern:
            type: integer
            format: uint32
            example: 7
            maximum: 9

  network_epc_configs:
    description: EPC (evolved packet core) cellular configuration for a network
    type: object
    minLength: 1
    required:
      - cloud_subscriberdb_enabled
      - default_rule_id
      - lte_auth_amf
      - lte_auth_op
      - mcc
      - mnc
      - relay_enabled
      - tac
    properties:
      mcc:
        type: string
        pattern: '^(\d{3})$'
        example: '001'
      mnc:
        type: string
        pattern: '^(\d{2,3})$'
        example: '01'
      tac:
        type: integer
        format: uint32
        maximum: 65535
        example: 1
      lte_auth_op:
        type: string
        format: byte
        example: EREREREREREREREREREREQ==
      lte_auth_amf:
        type: string
        format: byte
        example: gAA=
      sub_profiles:
        type: object
        additionalProperties:
          type: object
          properties:
            max_ul_bit_rate:
              type: integer
              format: uint64
              example: 100000000
            max_dl_bit_rate:
              type: integer
              format: uint64
              example: 20000000
      default_rule_id:
        type: string
        example: 'default_rule_1'
      relay_enabled:
        type: boolean
        example: false
      cloud_subscriberdb_enabled:
        type: boolean
        example: false
      network_services:
        description: Configuration for network services. Services will be instantiated in the listed order.
        type: array
        x-omitempty: true
        items:
          type: string
          enum:
            - 'metering'
            - 'dpi'
            - 'policy_enforcement'
        example:
          - 'metering'
          - 'dpi'
          - 'policy_enforcement'
